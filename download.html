<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Your Workflow — FlowForge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { bg: { base:'#0D0D0D', elevated:'#141414', floating:'#1C1C1C', border:'#2A2A2A' }, primary:{ DEFAULT:'#FF5500', hover:'#FF6A20', dim:'#CC4400' }, accent:'#00D4C8', forge:{ text:'#F5F5F0', muted:'#9A9A90', faint:'#5C5C58' } }, fontFamily:{ display:['"Playfair Display"','Georgia','serif'], sans:['Inter','system-ui','sans-serif'] } } }
    }
  </script>
  <style>
    *,*::before,*::after{box-sizing:border-box}
    body{background:radial-gradient(ellipse 70% 40% at 5% 0%,rgba(255,85,0,0.08) 0%,transparent 55%),radial-gradient(ellipse 50% 35% at 95% 100%,rgba(0,212,200,0.05) 0%,transparent 50%),#0D0D0D;color:#F5F5F0;font-family:'Inter',system-ui,sans-serif;min-height:100vh}
    body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#0D0D0D}::-webkit-scrollbar-thumb{background:#2A2A2A;border-radius:3px}::-webkit-scrollbar-thumb:hover{background:#FF5500}
    .btn-primary{display:inline-flex;align-items:center;gap:.5rem;padding:.875rem 2rem;background:#FF5500;color:#F5F5F0;font-family:'Inter',sans-serif;font-weight:600;font-size:1rem;border-radius:.5rem;border:1px solid rgba(255,106,32,.6);box-shadow:0 0 0 1px #FF5500,0 4px 24px rgba(255,85,0,.35),0 1px 4px rgba(0,0,0,.4);transition:transform .18s cubic-bezier(.34,1.56,.64,1),box-shadow .18s ease,background .15s ease;text-decoration:none;cursor:pointer}
    .btn-primary:hover{background:#FF6A20;transform:translateY(-2px);box-shadow:0 0 0 1px #FF6A20,0 6px 32px rgba(255,85,0,.5),0 1px 4px rgba(0,0,0,.4)}
    .btn-primary:focus-visible{outline:2px solid #00D4C8;outline-offset:3px}
    .btn-primary:active{background:#CC4400;transform:scale(.98)}
    .btn-secondary{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:transparent;color:#9A9A90;font-family:'Inter',sans-serif;font-weight:500;font-size:.9rem;border-radius:.5rem;border:1px solid #2A2A2A;text-decoration:none;transition:color .15s ease,border-color .15s ease}
    .btn-secondary:hover{color:#F5F5F0;border-color:#5C5C58}
    .nav-link{color:#9A9A90;text-decoration:none;font-size:.9rem;font-weight:500;position:relative;transition:color .15s ease}
    .nav-link::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#FF5500;transition:width .2s ease}
    .nav-link:hover{color:#F5F5F0}.nav-link:hover::after{width:100%}
    .step-card{background:#141414;border:1px solid #2A2A2A;border-radius:.875rem;padding:1.5rem;display:flex;align-items:flex-start;gap:1rem}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spinner{width:44px;height:44px;border:3px solid #2A2A2A;border-top-color:#FF5500;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .4s cubic-bezier(.34,1.56,.64,1) both}
    .success-glow{box-shadow:0 0 0 1px rgba(0,212,200,.2),0 0 48px rgba(0,212,200,.08),0 8px 32px rgba(0,0,0,.5)}
    .error-glow{box-shadow:0 0 0 1px rgba(255,85,0,.2),0 0 48px rgba(255,85,0,.06),0 8px 32px rgba(0,0,0,.5)}
  </style>
</head>
<body>

  <!-- NAV -->
  <nav style="position:sticky;top:0;z-index:50;background:rgba(28,28,28,.85);backdrop-filter:blur(12px);border-bottom:1px solid #2A2A2A">
    <div style="max-width:1200px;margin:0 auto;padding:0 1.5rem;display:flex;align-items:center;justify-content:space-between;height:64px">
      <a href="index.html" style="display:flex;align-items:center;gap:.625rem;text-decoration:none">
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><path d="M14 2L6 10L10 12L4 20L20 13L15 11L22 2L14 2Z" fill="#FF5500"/></svg>
        <span style="font-family:'Playfair Display',serif;font-weight:700;font-size:1.25rem;color:#F5F5F0;letter-spacing:-.02em">FlowForge</span>
      </a>
      <div style="display:flex;align-items:center;gap:2rem">
        <a href="products.html" class="nav-link">Products</a>
        <a href="index.html#faq" class="nav-link">FAQ</a>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main style="max-width:640px;margin:0 auto;padding:4rem 1.5rem 6rem;display:flex;flex-direction:column;align-items:center;text-align:center">

    <!-- LOADING STATE -->
    <div id="state-loading" style="display:flex;flex-direction:column;align-items:center;gap:1.5rem;padding:3rem 0">
      <div class="spinner"></div>
      <p style="color:#9A9A90;font-size:.9375rem">Verifying your payment…</p>
    </div>

    <!-- SUCCESS STATE -->
    <div id="state-success" style="display:none;width:100%">
      <div class="fade-up success-glow" style="background:#141414;border:1px solid rgba(0,212,200,.25);border-radius:1.25rem;padding:3rem 2.5rem;margin-bottom:2rem">
        <!-- Checkmark icon -->
        <div style="width:72px;height:72px;border-radius:50%;background:rgba(0,212,200,.1);border:1px solid rgba(0,212,200,.3);display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path d="M6 17L12 23L26 9" stroke="#00D4C8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>

        <h1 style="font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:#F5F5F0;letter-spacing:-.03em;margin-bottom:.75rem">
          Payment confirmed!
        </h1>
        <p style="color:#9A9A90;font-size:1rem;line-height:1.7;margin-bottom:2rem">
          Your workflow is ready. Click the button below to download it — then import it into n8n and you're live in minutes.
        </p>

        <a id="download-btn" href="#" class="btn-primary" style="width:100%;justify-content:center;font-size:1.0625rem;padding:1rem 2rem;margin-bottom:1rem">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 3v9m0 0l-3.5-3.5M10 12l3.5-3.5M3 16h14" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Download Workflow (.json)
        </a>
        <p style="color:#5C5C58;font-size:.8125rem">
          Having trouble? <a href="mailto:support@flowforge.io" style="color:#9A9A90;text-decoration:underline">Contact support</a>
        </p>
      </div>

      <!-- Import instructions -->
      <div style="text-align:left">
        <h2 style="font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:700;color:#F5F5F0;letter-spacing:-.02em;margin-bottom:1.25rem">
          How to import into n8n
        </h2>
        <div style="display:flex;flex-direction:column;gap:.75rem">
          <div class="step-card">
            <div style="flex-shrink:0;width:28px;height:28px;border-radius:50%;background:rgba(255,85,0,.12);border:1px solid rgba(255,85,0,.3);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:#FF5500">1</div>
            <div>
              <p style="color:#F5F5F0;font-size:.9rem;font-weight:500;margin-bottom:.25rem">Open n8n</p>
              <p style="color:#9A9A90;font-size:.85rem;line-height:1.6">Go to your n8n instance and navigate to the Workflows section.</p>
            </div>
          </div>
          <div class="step-card">
            <div style="flex-shrink:0;width:28px;height:28px;border-radius:50%;background:rgba(255,85,0,.12);border:1px solid rgba(255,85,0,.3);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:#FF5500">2</div>
            <div>
              <p style="color:#F5F5F0;font-size:.9rem;font-weight:500;margin-bottom:.25rem">Import the file</p>
              <p style="color:#9A9A90;font-size:.85rem;line-height:1.6">Click the menu (⋯) → <strong style="color:#F5F5F0">Import from file</strong>, then select the downloaded .json file.</p>
            </div>
          </div>
          <div class="step-card">
            <div style="flex-shrink:0;width:28px;height:28px;border-radius:50%;background:rgba(255,85,0,.12);border:1px solid rgba(255,85,0,.3);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:#FF5500">3</div>
            <div>
              <p style="color:#F5F5F0;font-size:.9rem;font-weight:500;margin-bottom:.25rem">Configure credentials</p>
              <p style="color:#9A9A90;font-size:.85rem;line-height:1.6">Connect your accounts (Google, Stripe, etc.) in the credential nodes, then activate the workflow.</p>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top:2.5rem;padding-top:2rem;border-top:1px solid #2A2A2A;display:flex;justify-content:center;gap:1rem;flex-wrap:wrap">
        <a href="products.html" class="btn-secondary">Browse More Workflows</a>
        <a href="index.html" class="btn-secondary">Back to Home</a>
      </div>
    </div>

    <!-- ERROR STATE -->
    <div id="state-error" style="display:none;width:100%">
      <div class="fade-up error-glow" style="background:#141414;border:1px solid rgba(255,85,0,.2);border-radius:1.25rem;padding:3rem 2.5rem">
        <div style="width:72px;height:72px;border-radius:50%;background:rgba(255,85,0,.1);border:1px solid rgba(255,85,0,.25);display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path d="M16 10v8M16 22v.5" stroke="#FF5500" stroke-width="2.5" stroke-linecap="round"/>
            <circle cx="16" cy="16" r="12" stroke="#FF5500" stroke-width="2"/>
          </svg>
        </div>
        <h1 style="font-family:'Playfair Display',serif;font-size:1.75rem;font-weight:700;color:#F5F5F0;letter-spacing:-.03em;margin-bottom:.75rem">
          Payment not verified
        </h1>
        <p style="color:#9A9A90;font-size:.9375rem;line-height:1.7;margin-bottom:2rem">
          We couldn't confirm your payment. If you completed checkout successfully, please contact support with your order email and we'll sort it out immediately.
        </p>
        <a href="mailto:support@flowforge.io" class="btn-primary" style="margin-bottom:1rem;width:100%;justify-content:center">
          Contact Support
        </a>
        <a href="products.html" class="btn-secondary" style="width:100%;justify-content:center">
          Back to Products
        </a>
      </div>
    </div>

  </main>

  <script>
    (function () {
      const params     = new URLSearchParams(location.search);
      const slug       = params.get('p');
      const sessionId  = params.get('session_id');

      const stateLoad  = document.getElementById('state-loading');
      const stateOk    = document.getElementById('state-success');
      const stateErr   = document.getElementById('state-error');

      function show(state) {
        stateLoad.style.display = 'none';
        stateOk.style.display   = 'none';
        stateErr.style.display  = 'none';
        state.style.display     = 'block';
      }

      // No params → error immediately
      if (!slug || !sessionId) {
        show(stateErr);
        return;
      }

      // Verify payment via local API
      fetch(`/api/verify?p=${encodeURIComponent(slug)}&session_id=${encodeURIComponent(sessionId)}`)
        .then(r => r.json())
        .then(({ ok }) => {
          if (ok) {
            const downloadUrl = `/api/download?p=${encodeURIComponent(slug)}&session_id=${encodeURIComponent(sessionId)}`;
            document.getElementById('download-btn').href = downloadUrl;
            show(stateOk);
          } else {
            show(stateErr);
          }
        })
        .catch(() => show(stateErr));
    })();
  </script>

</body>
</html>
